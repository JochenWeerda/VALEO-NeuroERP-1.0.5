[tox]
envlist = 
    py311-jose34,
    py311-jose33,
    py311-starlette-latest,
    py311-security-audit,
    py311-compatibility

isolated_build = True

[testenv]
deps = 
    pytest>=7.4.3
    pytest-asyncio>=0.21.1
    pytest-cov>=4.1.0
    httpx>=0.25.2
    fastapi>=0.115.14
    uvicorn[standard]>=0.24.0
    pydantic>=2.11.7
    python-dotenv>=1.0.0
    requests>=2.31.0

commands = 
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing

[testenv:py311-jose34]
deps = 
    {[testenv]deps}
    python-jose[cryptography]>=3.4.0
    starlette>=0.46.2
commands = 
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing -v

[testenv:py311-jose33]
deps = 
    {[testenv]deps}
    python-jose[cryptography]==3.3.0
    starlette>=0.46.2
commands = 
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing -v

[testenv:py311-starlette-latest]
deps = 
    {[testenv]deps}
    python-jose[cryptography]>=3.4.0
    starlette>=0.47.0
commands = 
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing -v

[testenv:py311-security-audit]
deps = 
    {[testenv]deps}
    python-jose[cryptography]>=3.4.0
    starlette>=0.46.2
    pip-audit>=2.6.1
    safety>=2.3.5
commands = 
    pip-audit --format=json --output=pip-audit-report.json
    safety check --json --output=safety-report.json
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing -v

[testenv:py311-compatibility]
deps = 
    {[testenv]deps}
    python-jose[cryptography]>=3.4.0
    starlette>=0.46.2
    pipdeptree>=2.28.0
commands = 
    pipdeptree --warn=fail-on-any
    pytest {posargs:tests/} --cov=backend --cov-report=term-missing -v

[testenv:lint]
deps = 
    black>=23.11.0
    isort>=5.12.0
    flake8>=6.1.0
    mypy>=1.7.1
commands = 
    black --check --diff .
    isort --check-only --diff .
    flake8 .
    mypy .

[testenv:format]
deps = 
    black>=23.11.0
    isort>=5.12.0
commands = 
    black .
    isort . 